# Testing #

[TOC]

This page describe test suite within PyFPDF library.

This page applicable to version 1.7.1 and newer (from trunk).

## Old tests ##

There are old tests in `tests` folder from stone-age. It will be remove when test suite completely overfill all old tests.

## Purposes ##

  * Cover all fixed issues
  * Reach **byte-to-byte accuracy** with all python versions (2.x and 3.x)
  * Alarm when required changes in library breaks something

## Selected solution ##

For now we switched to parallel support two ways:

  * `runtest.py` - custom script
  * [unittest](https://docs.python.org/3/library/unittest.html) - testing framework from standard Python library

## runtest.py ##

  * allow to test all available python interpreters.
  * better support for older Python versions
  * show pretty table with result
  * show hints
  * temporary files stored inside `tests/out-x.x.x` folder.

### Quick start ###

This is not not an exclusive list or methods.

Installed copy:

  * Goto to tests folder
  * Run `python runtest.py`

Local copy:

  * Goto to tests folder
  * set PYFPDFTESTLOCAL variable
  * Run `prepare_local.sh` or `prepare_local.bat`
  * Run `python runtest.py`

Distributive copy:

  * In root of distributive folder
  * `PYTHON_PATH=. python tests/runtest.py`

You can specify tests and/or interpreters list with `--test` and `--interp` arguments. For detailed information see `--help`.

Please note, batch operations test required minimum in library, but when you call any test directly with `python test/cover/text_xx.py`.

Allowed syntax for calling `tests/cover/*` tests:
 
  * `--auto` - do not add timestamp and author, do not open created PDF (of anything produced file)
  * `--check` - check PDF with hash
  * result filename.

PDF output with `--auto` may differ.

### Structure ###

  * `cover` - all new tests
  * `fpdf_local` - local copy fpdf, generated by prepare\_local
  * `out-x.x.x` - working directory for python x.x.x
  * `runtest.py` - batch tester
  * `resources.txt` - resources list
  * data files
  * old tests etc.

Every test can be executed as standalone app as from `tests/cover` or from `tests/out-x.x.x` folder. You can use `--downloadfonts` argument for `runtest.py`.

## unittest ##

  * familiarity, well documented framework (to specify different interpreters, enable warnings, etc)
  * better exception reporting when a test fails
  * show unclosed files and deprecations warnings
  * files created in current folder

### Quck start ###

```
PYTHON_PATH=. python -m unittest discover -s tests/cover/
```

## Variables ##

Variables:

  * `format` - PDF, TXT
  * `fn` - result filename (if test did't produce any external file it can be omitted)
  * `hash` - hash when in file created in automatic test mode
  * `2to3` - use 2to3 tool (default - no)
  * `python2` - this test can be used with python2 (default - yes)
  * `python3` - this test can be used with python3 (default - yes)
  * `pil` - PIL or Pillow module is required (default - no)
  * `platform` - platform for this test (win32, linux2, etc, by default - all.

## Fonts ##

Some (most) tests uses font pack http://pyfpdf.googlecode.com/files/fpdf_unicode_font_pack.zip

Place .ttf files in tests/font folder. You can use `--downloadfonts` option for `runtest.py` to download and extract them.

## Test template ##

File `tests/cover/test_template.py` contains all additional information.


